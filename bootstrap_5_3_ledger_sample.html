<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="keywords" content="">
  <meta name="author" content="">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <title>Standard Ledger</title>
  <style>
    .btn-group {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="row justify-content-md-center">
      <div class="col-md-12">
        <table class="table">
          <thead>
            <tr>
              <th>Medium</th>
              <th>Payee</th>
              <th>Memo</th>
              <th>Date of Transaction</th>
              <th>Dollar Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <select class="form-control">
                  <option>Check</option>
                  <option>Wire</option>
                  <option>Internal Transfer</option>
                  <option>Cash</option> <!-- Added Cash option -->
                </select>
              </td>
              <td>
                <input type="text" class="form-control">
              </td>
              <td>
                <input type="text" class="form-control">
              </td>
              <td>
                <input type="date" class="form-control">
              </td>
              <td>
                <input type="number" class="form-control">
              </td>
            </tr>
          </tbody>
        </table>
        <span id="totalAmount" style="float:right;margin-right:250px;">Total:</span>
        <div class="btn-group">
          <button class="btn btn-info" onclick="addRow()"><i class="fas fa-plus"></i> Add Row</button>
          <button class="btn btn-danger" onclick="deleteRow()"><i class="fas fa-trash"></i> Delete Row</button>
          <button class="btn btn-info" onclick="fillTable()"><i class="fas fa-table"></i> Fill Table</button>
          <button class="btn btn-info" onclick="addAmounts()"><i class="fas fa-calculator"></i> Total</button>
          <button class="btn btn-warning" onclick="saveTable()"><i class="fas fa-save"></i> Save</button>
          <button class="btn btn-success" onclick="exportToCSV()"><i class="fas fa-file-csv"></i> Export CSV</button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <!-- Bootstrap 5.3 JS (with Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    var data = [
      { medium: 'Check', payee: 'John Doe', memo: 'Invoice payment', date: '2022-01-01', amount: '100' },
      { medium: 'Wire', payee: 'Jane Doe', memo: 'Salary payment', date: '2022-02-01', amount: '1000' },
      { medium: 'Internal Transfer', payee: 'Carl Sagan', memo: 'Donation', date: '2022-02-01', amount: '3201.92' }
    ];

    $(document).ready(function () {
      $('.card-header button').on('click', function () {
        $(this).find('i').toggleClass('fa-caret-up fa-caret-down');
      });
    });

    function saveTable() {
      var table = document.querySelector("table tbody");
      var rows = table.rows;
      var data = [];
      for (var i = 0; i < rows.length; i++) {
        var medium = rows[i].cells[0].querySelector("select").value;
        var payee = rows[i].cells[1].querySelector("input").value;
        var memo = rows[i].cells[2].querySelector("input").value;
        var date = rows[i].cells[3].querySelector("input").value;
        var amount = rows[i].cells[4].querySelector("input").value;
        data.push({ medium: medium, payee: payee, memo: memo, date: date, amount: amount });
      }
      console.log(data);
    }

    function addAmounts() {
      var table = document.querySelector("table tbody");
      var rows = table.rows;
      var total = 0;
      for (var i = 0; i < rows.length; i++) {
        var amount = parseFloat(rows[i].cells[4].querySelector("input").value);
        total += amount;
      }
      var t = document.getElementById('totalAmount');
      t.innerHTML = 'Total: $' + total.toFixed(2);
    }

    function addRow() {
      var table = document.querySelector("table tbody");
      var newRow = document.createElement("tr");

      // Create new cells for each column
      var mediumCell = document.createElement("td");
      var payeeCell = document.createElement("td");
      var memoCell = document.createElement("td");
      var dateCell = document.createElement("td");
      var amountCell = document.createElement("td");

      // Create new form elements for each cell
      var mediumSelect = document.createElement("select");
      mediumSelect.classList.add("form-control");
      var option1 = document.createElement("option");
      option1.text = "Check";
      var option2 = document.createElement("option");
      option2.text = "Wire";
      var option3 = document.createElement("option");
      option3.text = "Internal Transfer";
      var option4 = document.createElement("option");
      option4.text = "Cash"; // Added Cash option
      mediumSelect.appendChild(option1);
      mediumSelect.appendChild(option2);
      mediumSelect.appendChild(option3);
      mediumSelect.appendChild(option4);
      mediumCell.appendChild(mediumSelect);

      var payeeInput = document.createElement("input");
      payeeInput.type = "text";
      payeeInput.classList.add("form-control");
      payeeCell.appendChild(payeeInput);

      var memoInput = document.createElement("input");
      memoInput.type = "text";
      memoInput.classList.add("form-control");
      memoCell.appendChild(memoInput);

      var dateInput = document.createElement("input");
      dateInput.type = "date";
      dateInput.classList.add("form-control");
      dateCell.appendChild(dateInput);

      var amountInput = document.createElement("input");
      amountInput.type = "number";
      amountInput.classList.add("form-control");
      amountCell.appendChild(amountInput);

      // Append cells to new row
      newRow.appendChild(mediumCell);
      newRow.appendChild(payeeCell);
      newRow.appendChild(memoCell);
      newRow.appendChild(dateCell);
      newRow.appendChild(amountCell);

      // Append new row to table
      table.appendChild(newRow);
    }

    function fillTable() {
      var table = document.querySelector("table tbody");
      var rows = table.rows;
      var rowCount = rows.length;
      for (var i = 0; i < rowCount; i++) {
        table.deleteRow(0);
      }
      for (var i = 0; i < data.length; i++) {
        addDataRow(data[i]);
      }
    }

    function addDataRow(data) {
      var table = document.querySelector("table tbody");
      var newRow = document.createElement("tr");

      // Create new cells for each column
      var mediumCell = document.createElement("td");
      var payeeCell = document.createElement("td");
      var memoCell = document.createElement("td");
      var dateCell = document.createElement("td");
      var amountCell = document.createElement("td");

      // Create new form elements for each cell
      var mediumSelect = document.createElement("select");
      mediumSelect.classList.add("form-control");
      var option1 = document.createElement("option");
      option1.text = "Check";
      var option2 = document.createElement("option");
      option2.text = "Wire";
      var option3 = document.createElement("option");
      option3.text = "Internal Transfer";
      var option4 = document.createElement("option");
      option4.text = "Cash"; // Added Cash option
      mediumSelect.appendChild(option1);
      mediumSelect.appendChild(option2);
      mediumSelect.appendChild(option3);
      mediumSelect.appendChild(option4);
      mediumSelect.value = data.medium;
      mediumCell.appendChild(mediumSelect);

      var payeeInput = document.createElement("input");
      payeeInput.type = "text";
      payeeInput.classList.add("form-control");
      payeeInput.value = data.payee;
      payeeCell.appendChild(payeeInput);

      var memoInput = document.createElement("input");
      memoInput.type = "text";
      memoInput.classList.add("form-control");
      memoInput.value = data.memo;
      memoCell.appendChild(memoInput);

      var dateInput = document.createElement("input");
      dateInput.type = "date";
      dateInput.classList.add("form-control");
      dateInput.value = data.date;
      dateCell.appendChild(dateInput);

      var amountInput = document.createElement("input");
      amountInput.type = "number";
      amountInput.classList.add("form-control");
      amountInput.value = data.amount;
      amountCell.appendChild(amountInput);

      // Append cells to new row
      newRow.appendChild(mediumCell);
      newRow.appendChild(payeeCell);
      newRow.appendChild(memoCell);
      newRow.appendChild(dateCell);
      newRow.appendChild(amountCell);

      // Append new row to table
      table.appendChild(newRow);
    }

    function deleteRow() {
      var table = document.querySelector("table tbody");
      var rows = table.rows;
      if (rows.length > 1) {
        table.deleteRow(rows.length - 1);
      }
    }

    // Export to CSV function
    function exportToCSV() {
      var table = document.querySelector("table");
      var rows = table.querySelectorAll("tr");
      var csv = [];

      // Add headers
      var headers = [];
      table.querySelectorAll("th").forEach(function (th) {
        headers.push(th.innerText);
      });
      csv.push(headers.join(","));

      // Add rows
      rows.forEach(function (row) {
        var rowData = [];
        row.querySelectorAll("td").forEach(function (td) {
          var input = td.querySelector("input, select");
          rowData.push(input ? input.value : "");
        });
        csv.push(rowData.join(","));
      });

      // Create CSV file
      var csvContent = "data:text/csv;charset=utf-8," + csv.join("\n");
      var encodedUri = encodeURI(csvContent);
      var link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "ledger.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>